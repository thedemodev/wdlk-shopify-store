$aspect-ratio-4-3  : 1.33333;
$aspect-ratio-3-4  : 0.75;
$dynamic-space-l   : ($size-L * 100) / 1440;
$dynamic-pane-width: (100 - ($dynamic-space-l * 4)) / 3;
$scaled-width      : $dynamic-pane-width / 100;
$pane-height       : 33.33;

$start-pane-counter: 1;
$end-pane-counter  : 4;
$expander-bezier   : cubic-bezier(0.860, 0.000, 0.070, 1.000);

@keyframes expand-container {
  0% {
    transform: scale3d(3, 1.5, 1);
  }

  10% {
    transform: scale3d(1.5, 1.25, 1);
  }

  100% {
    transform: scale3d(1, 1, 1);
  }
}

@keyframes collapse-container {
  0% {
    transform: scale3d(1, 1, 1);
  }

  70% {
    transform: scale3d(1.5, 1.25, 1);
  }

  100% {
    transform: scale3d(3, 1.5, 1);
  }
}

@keyframes expand-first-pane {
  0% {
    transform:
      scale3d(#{$scaled-width}, .7, 1)
      translate3d(-155%, 0, 0);
  }
  50% {
    transform:
      scale3d(#{$scaled-width}, .7, 1)
      translate3d(-50%, 0, 0);
  }
  100% {
    transform:
      scale3d(1, 1, 1)
      translate3d(-50%, 0, 0);
  }
}

@keyframes expand-last-pane {
  0% {
    transform:
      scale3d(#{$scaled-width}, .7, 1)
      translate3d(155%, 0, 0);
  }
  50% {
    transform:
      scale3d(#{$scaled-width}, .7, 1)
      translate3d(50%, 0, 0);
  }
  100% {
    transform:
      scale3d(1, 1, 1)
      translate3d(50%, 0, 0);
  }
}

.Expander {
  position: relative;
  height: 100vh;
  margin: auto;
  line-height: 1.5;

  @include media (medium) {
    height: calc(100vh - #{$nav-height-medium});
  }

  .Banner & {
    .Headline {
      color: $hex-white;
    }
  }

  &-pane {
    position: absolute;
    left: 0;
    z-index: 2;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    max-width: $screen-xl;
    cursor: pointer;
    transform: scale3d(1, .333, 1);
    transform-origin: top left;
    transition: transform .3s linear,
    z-index 1s linear;

    @include media (medium) {
      left: 50%;
      height: calc(100vh - #{$nav-height-medium});
      margin: auto;
      transform:
        scale3d(#{$scaled-width}, .7, 1)
        translate3d(-50%, 0, 0);

      &:first-of-type {
        transform:
          scale3d(#{$scaled-width}, .7, 1)
          translate3d(-155%, 0, 0);
        animation: expand-first-pane .5s linear;
      }

      &:nth-of-type(2) {
        transform:
          scale3d(#{$scaled-width}, .7, 1)
          translate3d(-50%, 30%, 0);
      }

      &:last-of-type {
        transform:
          scale3d(#{$scaled-width}, .7, 1)
          translate3d(55%, 0, 0);
        animation: expand-last-pane .5s linear;
      }
    }

    @for $n from $start-pane-counter to $end-pane-counter {
      &:nth-of-type(0n + #{$n}) {
        $counter: $n;
        $position-top: ($n - 1) * $pane-height;
        top: #{$position-top}vh;

        @include media(medium) {
          top: auto;
        }
      }
    }
  }

  &-container {
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    width: 100vw;
    height: 100vh;
    padding: 0 #{$size-L}px #{$size-L}px;
    margin: {
      right: auto;
      left: auto;
    }
    transform: scale3d(1, 3.33, 1);
    transform-origin: top center;
    color: white;

    @include media(medium) {
      height: calc(100vh - #{$nav-height-medium});
      max-width: $screen-xl;
      padding: #{$size-L}px #{$size-4XL}px #{$size-4XL}px;
      animation: collapse-container .26s linear;
      transform: scale3d(3, 1.5, 1);
    }
  }

  &-content {
    align-self: flex-end;
    max-width: 63rem;
    opacity: 0;
    transform: translate3d(0, 150%, 0);
    transition: opacity .33s linear, transform .33s $expander-bezier;
    transition-delay: 0;
  }

  &-intro {
    position: absolute;
    left: 50%;
    top: 10vh;
    transform: translate3d(-50%, 0, 0);
    transition: opacity linear .33s;
    transition-delay: .2s;
    @include media(medium) {
      top: 50%;
    }
  }

  &-img {
    position: absolute;
    left: 0;
    bottom: 0;
    z-index: -1;
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: left;
  }

  &-close {
    position: absolute;
    top: 20px;
    right: 20px;
    opacity: 0;
    pointer-events: auto;
    transition: opacity .6s linear;
  }

  &-state {
    position: absolute;
    z-index: -1;
    clip-path: inset(6px 6px 6px 6px);

    &:checked {
      + .Expander-pane {
        z-index: 10;
        max-width: 100vw;
        transform: scale3d(1, 1, 1);

        .Expander-container {
          transform: scale3d(1, 1, 1);

          @include media(medium) {
            animation: expand-container .3s linear;
          }

          @include media (xlarge) {
            max-width: $screen-xl + 480;
          }
        }

        .Expander-intro {
          opacity: 0;
          transition: none;
          transition-delay: .2s;
        }

        .Expander-content {
          opacity: 1;
          transform: none;
          transition-delay: .5s;
        }

        .Expander-close {
          opacity: 1;
        }
      }
    }

    @for $n from $start-pane-counter to $end-pane-counter {
      &:nth-of-type(0n + #{$n}) {
        &:checked {
          + .Expander-pane {
            @media (min-width: 768px) {
              transform: scale3d(1, 1, 1)
                translate3d(-50%, 0, 0);
            }

            @if $n == 2 {
              transform: scale3d(1, 1, 1)
                translate3d(0, #{-$pane-height}vh, 0);
            }

            @if $n == 3 {
            transform: scale3d(1, 1, 1)
              translate3d(0, #{-$pane-height * 2}vh, 0);
            }
          }
        }
      }
    }
  }
}
